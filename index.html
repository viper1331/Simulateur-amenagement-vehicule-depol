<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Simulateur 3D de véhicule de dépollution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app">
    <header class="top-bar">
      <div class="brand">Simulateur 3D de dépollution</div>
      <div class="actions">
        <button id="btn-new">Nouveau</button>
        <button id="btn-open">Ouvrir JSON</button>
        <button id="btn-save">Sauvegarder JSON</button>
        <button id="btn-export-png">Exporter PNG</button>
        <button id="btn-analyze">Analyser</button>
        <button id="btn-compare">Comparer (A vs B)</button>
      </div>
      <input type="file" id="file-input" accept="application/json" hidden>
    </header>
    <main class="workspace">
      <aside class="panel left">
        <section>
          <h2>Châssis</h2>
          <label for="chassis-select">Modèle</label>
          <select id="chassis-select"></select>
          <div class="chassis-stats">
            <div><span>PTAC :</span> <span id="chassis-ptac">-</span></div>
            <div><span>Empattement :</span> <span id="chassis-wheelbase">-</span></div>
            <div><span>Masse :</span> <span id="chassis-mass">-</span></div>
            <div><span>Dimensions :</span> <span id="chassis-dims">-</span></div>
          </div>
          <button id="btn-add-chassis" class="secondary" data-collapsed-label="Ajouter un châssis personnalisé" data-expanded-label="Masquer le formulaire">Ajouter un châssis personnalisé</button>
          <form id="chassis-form" class="inline-form is-collapsed">
            <div class="form-row">
              <label for="chassis-name">Nom</label>
              <input id="chassis-name" name="name" type="text" required placeholder="Ex. Châssis 20T">
            </div>
            <div class="form-row">
              <label for="chassis-length">Longueur (m)</label>
              <input id="chassis-length" name="length" type="number" min="1" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="chassis-width">Largeur (m)</label>
              <input id="chassis-width" name="width" type="number" min="1" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="chassis-height">Hauteur (m)</label>
              <input id="chassis-height" name="height" type="number" min="0.5" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="chassis-mass-input">Masse à vide (kg)</label>
              <input id="chassis-mass-input" name="mass" type="number" min="0" step="10" required>
            </div>
            <div class="form-row">
              <label for="chassis-ptac-input">PTAC (kg)</label>
              <input id="chassis-ptac-input" name="ptac" type="number" min="0" step="10" required>
            </div>
            <div class="form-row">
              <label for="chassis-wheelbase-input">Empattement (m)</label>
              <input id="chassis-wheelbase-input" name="wheelbase" type="number" min="1" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="chassis-front-axle">Décalage essieu AV (m)</label>
              <input id="chassis-front-axle" name="frontAxleOffset" type="number" min="0" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="chassis-color">Couleur</label>
              <input id="chassis-color" name="color" type="color" value="#6b7a8f">
            </div>
            <div class="form-actions">
              <button type="submit">Enregistrer</button>
              <button type="button" class="ghost" data-close-form>Annuler</button>
            </div>
          </form>
        </section>
        <section>
          <h2>Modules</h2>
          <button id="btn-add-module" class="secondary" data-collapsed-label="Ajouter un module personnalisé" data-expanded-label="Masquer le formulaire">Ajouter un module personnalisé</button>
          <form id="module-form" class="inline-form is-collapsed">
            <div class="form-row">
              <label for="module-name">Nom</label>
              <input id="module-name" name="name" type="text" required placeholder="Ex. Cuve spéciale">
            </div>
            <div class="form-row">
              <label for="module-type">Type</label>
              <input id="module-type" name="type" type="text" required value="Custom">
            </div>
            <div class="form-row">
              <label for="module-length">Longueur (m)</label>
              <input id="module-length" name="sizeZ" type="number" min="0.2" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="module-width">Largeur (m)</label>
              <input id="module-width" name="sizeX" type="number" min="0.2" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="module-height">Hauteur (m)</label>
              <input id="module-height" name="sizeY" type="number" min="0.2" step="0.01" required>
            </div>
            <div class="form-row">
              <label for="module-mass">Masse à vide (kg)</label>
              <input id="module-mass" name="massEmpty" type="number" min="0" step="1" required>
            </div>
            <div class="form-row">
              <label for="module-volume">Volume de fluide (L)</label>
              <input id="module-volume" name="fluidVolume" type="number" min="0" step="10" required>
            </div>
            <div class="form-row">
              <label for="module-fill">Remplissage par défaut (%)</label>
              <input id="module-fill" name="defaultFill" type="number" min="0" max="100" step="5" value="0" required>
            </div>
            <div class="form-row">
              <label for="module-density">Densité fluide (kg/m³)</label>
              <input id="module-density" name="density" type="number" min="1" step="10" value="1000" required>
            </div>
            <div class="form-row">
              <label for="module-color">Couleur</label>
              <input id="module-color" name="color" type="color" value="#2c7ef4">
            </div>
            <div class="form-actions">
              <button type="submit">Enregistrer</button>
              <button type="button" class="ghost" data-close-form>Annuler</button>
            </div>
          </form>
          <div id="module-buttons"></div>
          <ul id="module-list"></ul>
        </section>
        <section>
          <h2>Couloir de circulation</h2>
          <label for="walkway-width">Largeur (mm)</label>
          <input type="range" id="walkway-width" min="400" max="1200" step="50">
          <div class="range-value"><span id="walkway-width-value">-</span></div>
          <label class="checkbox">
            <input type="checkbox" id="walkway-toggle" checked>
            <span>Afficher le couloir</span>
          </label>
        </section>
      </aside>
      <section class="viewport">
        <div id="canvas-container"></div>
        <div id="hud"></div>
      </section>
      <aside class="panel right">
        <section>
          <h2>Module sélectionné</h2>
          <div id="selection-details">
            <div class="detail"><span>Nom :</span><span id="detail-name">-</span></div>
            <div class="detail"><span>Masse vide :</span><span id="detail-mass">-</span></div>
            <div class="detail"><span>Capacité :</span><span id="detail-capacity">-</span></div>
            <div class="detail"><span>Remplissage :</span>
              <input type="range" id="detail-fill" min="0" max="100" step="5">
              <span id="detail-fill-value">0%</span>
            </div>
            <div class="detail"><span>Position X :</span><input type="number" id="detail-pos-x" step="0.01"></div>
            <div class="detail"><span>Position Y :</span><input type="number" id="detail-pos-y" step="0.01"></div>
            <div class="detail"><span>Position Z :</span><input type="number" id="detail-pos-z" step="0.01"></div>
            <div class="detail"><span>Rotation Y :</span><input type="number" id="detail-rot-y" step="5"></div>
          </div>
        </section>
        <section>
          <h2>Analyse rapide</h2>
          <div class="analysis">
            <div><span>Masse totale :</span><span id="analysis-mass">-</span></div>
            <div><span>Centre de gravité :</span><span id="analysis-cog">-</span></div>
            <div><span>Charge essieu AV :</span><span id="analysis-front">-</span></div>
            <div><span>Charge essieu AR :</span><span id="analysis-rear">-</span></div>
            <div><span>Marge PTAC :</span><span id="analysis-margin">-</span></div>
          </div>
        </section>
        <section>
          <h2>Historique</h2>
          <div class="history-controls">
            <button id="btn-undo" title="Ctrl+Z">Annuler</button>
            <button id="btn-redo" title="Ctrl+Y">Rétablir</button>
          </div>
        </section>
      </aside>
    </main>
    <footer class="status-bar">
      <div class="indicator" id="indicator-ptac">PTAC</div>
      <div class="indicator" id="indicator-walkway">Couloir</div>
      <div class="indicator" id="indicator-errors">Erreurs</div>
      <div class="shortcuts">
        <span>Sélection: clic gauche</span>
        <span>Déplacer: mode T + glisser</span>
        <span>Rotation: mode R + glisser</span>
        <span>Supprimer: Suppr</span>
        <span>Undo/Redo: Ctrl+Z / Ctrl+Y</span>
      </div>
    </footer>
  </div>
  <div id="modal" class="modal hidden">
    <div class="modal-content">
      <header>
        <h3 id="modal-title">Titre</h3>
        <button id="modal-close">×</button>
      </header>
      <div id="modal-body"></div>
      <footer>
        <button id="modal-ok">Fermer</button>
      </footer>
    </div>
  </div>
  <script type="module" src="script.js"></script>
</body>
</html>
